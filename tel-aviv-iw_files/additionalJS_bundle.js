
(function($){var $prevVisibleToolTip;$.fn.extend({tooltip:function(options){var settings=$.extend({},$.fn.tooltip.defaults,options);return this.each(function(){new $.ToolTip(this,settings);});},tooltipHide:function(){return this.trigger("hide");},tooltipShow:function(){return this.trigger("show");}});$.ToolTip=function(obj,options){var toolTipAnchorElem=obj;var $input=$(toolTipAnchorElem);var toolTipContainer=$input.children('span');var pos='';var posTop='';var posArrowLeft='';var arrowPos='right';debug("init tooltip",toolTipContainer);randomId=Math.random().toString();randomId=randomId.substr(2,randomId.length);toolTipContainer.attr("jToolTipId",randomId);$input.attr("id","tt"+randomId);$('body').append(toolTipContainer);var o=$.meta?$.extend({},options,$input.data()):options;$input.bind('show',function(){showParent();}).bind('hide',function(){hideParent();});$input.mouseover(function(){if(toolTipContainer.is(':hidden')){showParent();}}).mouseout(function(){if(toolTipContainer.is(':visible')){hideParent();}});$input.focus(function(){if(toolTipContainer.is(':hidden')){showParent();}}).blur(function(){if(toolTipContainer.is(':visible')){hideParent();}});switch(o.position){case'left':createLeft();break;case'bottom':createBottom();break;case'top':createTop();break;case'right':default:break;}
function createRight(){var parent=$input.parent();if(!$input.is(':input')){$input.before('<div class="boxTooltipContent">'+text+'</div>');$input.prev('div').wrap('<div class="boxTooltipTopLeft"></div>');$input.prev('div').wrap('<div class="boxTooltipBottomRight"></div>');$input.prev('div').wrap('<div class="boxTooltip posRight posRightFromTop"></div>');$input.prev('div').children().before('<div class="boxTooltipBottomLeft"></div>');$input.prev('div').children('div.boxTooltipBottomLeft').before('<div class="boxTooltipTopRight"></div>');$input.prev('div').wrap('<div class="boxTooltipContainer" id="'+toolTipElementId+'"></div>');}else{if(parent.is('td')){parent.append('<div class="boxTooltipContent">'+text+'</div>');parent.children('div:last').wrap('<div class="boxTooltipTopLeft"></div>');parent.children('div:last').wrap('<div class="boxTooltipBottomRight"></div>');parent.children('div:last').wrap('<div class="boxTooltip posRight"></div>');parent.children('div:last').children().before('<div class="boxTooltipBottomLeft"></div>');parent.children('div:last').children('div.boxTooltipBottomLeft').before('<div class="boxTooltipTopRight"></div>');parent.children('div:last').wrap('<div class="boxTooltipContainer" id="'+toolTipElementId+'"></div>');}
else{$input.after('<div class="boxTooltipContent">'+text+'</div>');$input.next('div').wrap('<div class="boxTooltipTopLeft"></div>');$input.next('div').wrap('<div class="boxTooltipBottomRight"></div>');$input.next('div').wrap('<div class="boxTooltip posRight"></div>');$input.next('div').children().before('<div class="boxTooltipBottomLeft"></div>');$input.next('div').children('div.boxTooltipBottomLeft').before('<div class="boxTooltipTopRight"></div>');$input.next('div').wrap('<div class="boxTooltipContainer" id="'+toolTipElementId+'"></div>');}}
if(!options.visible){hideParent($input);}};function createLeft(){$input.after('<div class="boxTooltipContent">'+text+'</div>');$input.next('div').wrap('<div class="boxTooltipTopLeft"></div>');$input.next('div').wrap('<div class="boxTooltipBottomRight"></div>');$input.next('div').wrap('<div class="boxTooltip posLeft"></div>');$input.next('div').children().before('<div class="boxTooltipBottomLeft"></div>');$input.next('div').children('div.boxTooltipBottomLeft').before('<div class="boxTooltipTopRight"></div>');$input.next('div').wrap('<div class="boxTooltipContainer" id="'+toolTipElementId+'"></div>');if(!options.visible){hideParent($input);}};function createBottom(){$input.after('<div class="boxTooltipContent">'+text+'</div>');$input.next('div').wrap('<div class="boxTooltipTopLeft"></div>');$input.next('div').wrap('<div class="boxTooltipBottomRight"></div>');$input.next('div').wrap('<div class="boxTooltip posBottom"></div>');$input.next('div').children().before('<div class="boxTooltipBottomLeft"></div>');$input.next('div').children('div.boxTooltipBottomLeft').before('<div class="boxTooltipTopRight"></div>');$input.next('div').wrap('<div class="boxTooltipContainer" id="'+toolTipElementId+'"></div>');if(!options.visible){hideParent($input);}};function createTop(){$input.before('<div class="boxTooltipContent">'+text+'</div>');$input.prev('div').wrap('<div class="boxTooltipTopLeft"></div>');$input.prev('div').wrap('<div class="boxTooltipBottomRight"></div>');$input.prev('div').wrap('<div class="boxTooltip posTop"></div>');$input.prev('div').children().before('<div class="boxTooltipBottomLeft"></div>');$input.prev('div').children('div.boxTooltipBottomLeft').before('<div class="boxTooltipTopRight"></div>');$input.prev('div').wrap('<div class="boxTooltipContainer" id="'+toolTipElementId+'"></div>');if(!options.visible){hideParent($input);}};function hideParent(){toolTipContainer.hide();$prevVisibleToolTip=null;};function showParent(){if($prevVisibleToolTip!=null){$prevVisibleToolTip.hide();}
positioning();toolTipContainer.show();$prevVisibleToolTip=toolTipContainer;};function getTopPosition(){var tmpElem=obj;var top=0;var curtop=0;if(tmpElem.offsetParent){while(1){curtop+=tmpElem.offsetTop;if(!tmpElem.offsetParent){break;}
tmpElem=tmpElem.offsetParent;}}else if(tmpElem.y){curtop+=tmpElem.y;}
top=curtop;return top;};function getLeftPosition(){var tmpElem=obj;var left=0;var curleft=0;if(tmpElem.offsetParent){while(1){curleft+=tmpElem.offsetLeft;if(!tmpElem.offsetParent){break;}
tmpElem=tmpElem.offsetParent;}}else if(tmpElem.x){curleft+=tmpElem.x;}
left=curleft;return left;};function settings(obj,text,options){return $.ToolTip(obj,text,options);}
function positioning(){var left=getLeftPosition();var top=getTopPosition();arrowSize=20;arrowPosTop=0;if(pos!=''){$(toolTipContainer.find('.toolTipArrow')).css({'background-position':pos[0]+' '+pos[1]});}
switch(o.arrowDirection){case'right':arrowPosTop=0;left=left-(toolTipContainer.width()+arrowSize);top=top-45;toolTipContainer.removeClass("toolTipRight");toolTipContainer.addClass("toolTipLeft");break;case'left':top=top-45;left+=arrowSize+20;var p=$(toolTipContainer.find(".toolTipArrow")).css("background-position");if(pos==''){var p=$(toolTipContainer.find(".toolTipArrow")).css("background-position");if(typeof(p)==='undefined'){pos=($(toolTipContainer.find(".toolTipArrow")).css('background-position-x')+' '+$(toolTipContainer.find(".toolTipArrow")).css('background-position-y')).split(" ");}else{pos=p.split(" ");}
posTop=top;tmpPos=pos;tmpTop=top;}else{tmpPos=pos;tmpTop=posTop;}
if(posArrowLeft==''){posArrowLeft=$('#tt'+toolTipContainer.attr('jtooltipid')).offset().left;}
arrowInnerLeft=parseInt(tmpPos[0].replace("px",""))+27;arrowInnerTop=tmpPos[1]
arrowInner=arrowInnerLeft+'px '+arrowInnerTop;debug(posArrowLeft+"-"+toolTipContainer.innerWidth()+'--'+(posArrowLeft-toolTipContainer.innerWidth()));$(toolTipContainer.find('.toolTipArrow')).css({'background-position':arrowInner});$(toolTipContainer.find('.toolTipArrow')).css({'left':'-11px'});break;case'top':arrowPosTop=-20;break;}
toolTipContainer.css('left',left);top=top+$input.height()+arrowSize;toolTipContainer.css('top',top);var v=viewport();if(v.x+v.cx<left+toolTipContainer.innerWidth()){var mainwidth=v.x+v.cx;left=mainwidth-(toolTipContainer.innerWidth()+20);toolTipContainer.css({left:left+'px'});ankPos=$('#tt'+toolTipContainer.attr('jtooltipid')).offset().left-mainwidth+toolTipContainer.innerWidth()+10;$(toolTipContainer.find('.toolTipArrow')).css({'left':ankPos+'px'});}else{}
if(v.y+v.cy<top+toolTipContainer.innerHeight()){ankPos=$('#tt'+toolTipContainer.attr('jtooltipid')).offset().top;top=(ankPos-toolTipContainer.innerHeight())+$(window).scrollTop();if(top){top+=40;}
toolTipContainer.css({top:top+'px'});debug("ankPos: "+ankPos);arrowPosTop=ankPos-top-10;debug("arrowPosTop: "+arrowPosTop);}
$(toolTipContainer.find('.toolTipArrow')).css({top:arrowPosTop+"px"});}
function switchArrow(arrowPosition){if(pos==''){var p=$(toolTipContainer.find(".toolTipArrow")).css("background-position");if(typeof(p)==='undefined'){pos=($(toolTipContainer.find(".toolTipArrow")).css('background-position-x')+' '+$(toolTipContainer.find(".toolTipArrow")).css('background-position-y')).split(" ");}else{pos=p.split(" ");}
posTop=top;tmpPos=pos;tmpTop=top;}else{tmpPos=pos;tmpTop=posTop;}
switch(o.arrowDirection){case'right':arrowPosTop=arrowPosition+25;break;case'top':arrowPosTop=toolTipContainer.innerHeight()+7;arrowTop=$(toolTipContainer.find('.toolTipArrow')).offset().top+toolTipContainer.innerHeight()+7;arrowInnerLeft=parseInt(tmpPos[0].replace("px",""))+40;arrowInnerTop=parseInt(tmpPos[1].replace("px",""))-32;arrowInner=arrowInnerLeft+'px '+arrowInnerTop+'px';$(toolTipContainer.find('.toolTipArrow')).css({'background-position':arrowInner});break;}}
function viewport(){return{x:$('.maincontent').offset().left,y:$(window).scrollTop(),cx:$('.maincontent').width(),cy:$(window).height()};}
function debug(message,param){return;if(window.console&&window.console.log){window.console.log(message,(param)?param:"");}}};$.fn.tooltip.show=function(){};$.fn.tooltip.hide=function(){};$.fn.tooltip.defaults={position:'right',visible:false,arrowDirection:'top'};})(jQuery);jQuery.cookie=function(name,value,options){if(typeof value!='undefined'){options=options||{};if(value===null){value='';options.expires=-1;}
var expires='';if(options.expires&&(typeof options.expires=='number'||options.expires.toUTCString)){var date;if(typeof options.expires=='number'){date=new Date();date.setTime(date.getTime()+(options.expires*24*60*60*1000));}else{date=options.expires;}
expires='; expires='+date.toUTCString();}
var path=options.path?'; path='+(options.path):'';var domain=options.domain?'; domain='+(options.domain):'';var secure=options.secure?'; secure':'';document.cookie=[name,'=',encodeURIComponent(value),expires,path,domain,secure].join('');}else{var cookieValue=null;if(document.cookie&&document.cookie!=''){var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==(name+'=')){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break;}}}
return cookieValue;}};;(function($){$.fn.ajaxSubmit=function(options){if(!this.length){log('ajaxSubmit: skipping submit process - no element selected');return this;}
if(typeof options=='function')
options={success:options};var url=$.trim(this.attr('action'));if(url){url=(url.match(/^([^#]+)/)||[])[1];}
url=url||window.location.href||'';options=$.extend({url:url,type:this.attr('method')||'GET',iframeSrc:/^https/i.test(window.location.href||'')?'javascript:false':'about:blank'},options||{});var veto={};this.trigger('form-pre-serialize',[this,options,veto]);if(veto.veto){log('ajaxSubmit: submit vetoed via form-pre-serialize trigger');return this;}
if(options.beforeSerialize&&options.beforeSerialize(this,options)===false){log('ajaxSubmit: submit aborted via beforeSerialize callback');return this;}
var a=this.formToArray(options.semantic);if(options.data){options.extraData=options.data;for(var n in options.data){if(options.data[n]instanceof Array){for(var k in options.data[n])
a.push({name:n,value:options.data[n][k]});}
else
a.push({name:n,value:options.data[n]});}}
if(options.beforeSubmit&&options.beforeSubmit(a,this,options)===false){log('ajaxSubmit: submit aborted via beforeSubmit callback');return this;}
this.trigger('form-submit-validate',[a,this,options,veto]);if(veto.veto){log('ajaxSubmit: submit vetoed via form-submit-validate trigger');return this;}
var q=$.param(a);if(options.type.toUpperCase()=='GET'){options.url+=(options.url.indexOf('?')>=0?'&':'?')+q;options.data=null;}
else
options.data=q;var $form=this,callbacks=[];if(options.resetForm)callbacks.push(function(){$form.resetForm();});if(options.clearForm)callbacks.push(function(){$form.clearForm();});if(!options.dataType&&options.target){var oldSuccess=options.success||function(){};callbacks.push(function(data){var fn=options.replaceTarget?'replaceWith':'html';$(options.target)[fn](data).each(oldSuccess,arguments);});}
else if(options.success)
callbacks.push(options.success);options.success=function(data,status,xhr){for(var i=0,max=callbacks.length;i<max;i++)
callbacks[i].apply(options,[data,status,xhr||$form,$form]);};var files=$('input:file',this).fieldValue();var found=false;for(var j=0;j<files.length;j++)
if(files[j])
found=true;var multipart=false;if((files.length&&options.iframe!==false)||options.iframe||found||multipart){if(options.closeKeepAlive)
$.get(options.closeKeepAlive,fileUpload);else
fileUpload();}
else
$.ajax(options);this.trigger('form-submit-notify',[this,options]);return this;function fileUpload(){var form=$form[0];if($(':input[name=submit]',form).length){alert('Error: Form elements must not be named "submit".');return;}
var opts=$.extend({},$.ajaxSettings,options);var s=$.extend(true,{},$.extend(true,{},$.ajaxSettings),opts);var id='jqFormIO'+(new Date().getTime());var $io=$('<iframe id="'+id+'" name="'+id+'" src="'+opts.iframeSrc+'" onload="(jQuery(this).data(\'form-plugin-onload\'))()" />');var io=$io[0];$io.css({position:'absolute',top:'-1000px',left:'-1000px'});var xhr={aborted:0,responseText:null,responseXML:null,status:0,statusText:'n/a',getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){this.aborted=1;$io.attr('src',opts.iframeSrc);}};var g=opts.global;if(g&&!$.active++)$.event.trigger("ajaxStart");if(g)$.event.trigger("ajaxSend",[xhr,opts]);if(s.beforeSend&&s.beforeSend(xhr,s)===false){s.global&&$.active--;return;}
if(xhr.aborted)
return;var cbInvoked=false;var timedOut=0;var sub=form.clk;if(sub){var n=sub.name;if(n&&!sub.disabled){opts.extraData=opts.extraData||{};opts.extraData[n]=sub.value;if(sub.type=="image"){opts.extraData[n+'.x']=form.clk_x;opts.extraData[n+'.y']=form.clk_y;}}}
function doSubmit(){var t=$form.attr('target'),a=$form.attr('action');form.setAttribute('target',id);if(form.getAttribute('method')!='POST')
form.setAttribute('method','POST');if(form.getAttribute('action')!=opts.url)
form.setAttribute('action',opts.url);if(!opts.skipEncodingOverride){$form.attr({encoding:'multipart/form-data',enctype:'multipart/form-data'});}
if(opts.timeout)
setTimeout(function(){timedOut=true;cb();},opts.timeout);var extraInputs=[];try{if(opts.extraData)
for(var n in opts.extraData)
extraInputs.push($('<input type="hidden" name="'+n+'" value="'+opts.extraData[n]+'" />').appendTo(form)[0]);$io.appendTo('body');$io.data('form-plugin-onload',cb);form.submit();}
finally{form.setAttribute('action',a);t?form.setAttribute('target',t):$form.removeAttr('target');$(extraInputs).remove();}};if(opts.forceSync)
doSubmit();else
setTimeout(doSubmit,10);var domCheckCount=100;function cb(){if(cbInvoked)
return;var ok=true;try{if(timedOut)throw'timeout';var data,doc;doc=io.contentWindow?io.contentWindow.document:io.contentDocument?io.contentDocument:io.document;var isXml=opts.dataType=='xml'||doc.XMLDocument||$.isXMLDoc(doc);log('isXml='+isXml);if(!isXml&&(doc.body==null||doc.body.innerHTML=='')){if(--domCheckCount){log('requeing onLoad callback, DOM not available');setTimeout(cb,250);return;}
log('Could not access iframe DOM after 100 tries.');return;}
log('response detected');cbInvoked=true;xhr.responseText=doc.body?doc.body.innerHTML:null;xhr.responseXML=doc.XMLDocument?doc.XMLDocument:doc;xhr.getResponseHeader=function(header){var headers={'content-type':opts.dataType};return headers[header];};if(opts.dataType=='json'||opts.dataType=='script'){var ta=doc.getElementsByTagName('textarea')[0];if(ta)
xhr.responseText=ta.value;else{var pre=doc.getElementsByTagName('pre')[0];if(pre)
xhr.responseText=pre.innerHTML;}}
else if(opts.dataType=='xml'&&!xhr.responseXML&&xhr.responseText!=null){xhr.responseXML=toXml(xhr.responseText);}
data=$.httpData(xhr,opts.dataType);}
catch(e){log('error caught:',e);ok=false;xhr.error=e;$.handleError(opts,xhr,'error',e);}
if(ok){opts.success(data,'success');if(g)$.event.trigger("ajaxSuccess",[xhr,opts]);}
if(g)$.event.trigger("ajaxComplete",[xhr,opts]);if(g&&!--$.active)$.event.trigger("ajaxStop");if(opts.complete)opts.complete(xhr,ok?'success':'error');setTimeout(function(){$io.removeData('form-plugin-onload');$io.remove();xhr.responseXML=null;},100);};function toXml(s,doc){if(window.ActiveXObject){doc=new ActiveXObject('Microsoft.XMLDOM');doc.async='false';doc.loadXML(s);}
else
doc=(new DOMParser()).parseFromString(s,'text/xml');return(doc&&doc.documentElement&&doc.documentElement.tagName!='parsererror')?doc:null;};};};$.fn.ajaxForm=function(options){return this.ajaxFormUnbind().bind('submit.form-plugin',function(e){e.preventDefault();$(this).ajaxSubmit(options);}).bind('click.form-plugin',function(e){var target=e.target;var $el=$(target);if(!($el.is(":submit,input:image"))){var t=$el.closest(':submit');if(t.length==0)
return;target=t[0];}
var form=this;form.clk=target;if(target.type=='image'){if(e.offsetX!=undefined){form.clk_x=e.offsetX;form.clk_y=e.offsetY;}else if(typeof $.fn.offset=='function'){var offset=$el.offset();form.clk_x=e.pageX-offset.left;form.clk_y=e.pageY-offset.top;}else{form.clk_x=e.pageX-target.offsetLeft;form.clk_y=e.pageY-target.offsetTop;}}
setTimeout(function(){form.clk=form.clk_x=form.clk_y=null;},100);});};$.fn.ajaxFormUnbind=function(){return this.unbind('submit.form-plugin click.form-plugin');};$.fn.formToArray=function(semantic){var a=[];if(this.length==0)return a;var form=this[0];var els=semantic?form.getElementsByTagName('*'):form.elements;if(!els)return a;for(var i=0,max=els.length;i<max;i++){var el=els[i];var n=el.name;if(!n)continue;if(semantic&&form.clk&&el.type=="image"){if(!el.disabled&&form.clk==el){a.push({name:n,value:$(el).val()});a.push({name:n+'.x',value:form.clk_x},{name:n+'.y',value:form.clk_y});}
continue;}
var v=$.fieldValue(el,true);if(v&&v.constructor==Array){for(var j=0,jmax=v.length;j<jmax;j++)
a.push({name:n,value:v[j]});}
else if(v!==null&&typeof v!='undefined')
a.push({name:n,value:v});}
if(!semantic&&form.clk){var $input=$(form.clk),input=$input[0],n=input.name;if(n&&!input.disabled&&input.type=='image'){a.push({name:n,value:$input.val()});a.push({name:n+'.x',value:form.clk_x},{name:n+'.y',value:form.clk_y});}}
return a;};$.fn.formSerialize=function(semantic){return $.param(this.formToArray(semantic));};$.fn.fieldSerialize=function(successful){var a=[];this.each(function(){var n=this.name;if(!n)return;var v=$.fieldValue(this,successful);if(v&&v.constructor==Array){for(var i=0,max=v.length;i<max;i++)
a.push({name:n,value:v[i]});}
else if(v!==null&&typeof v!='undefined')
a.push({name:this.name,value:v});});return $.param(a);};$.fn.fieldValue=function(successful){for(var val=[],i=0,max=this.length;i<max;i++){var el=this[i];var v=$.fieldValue(el,successful);if(v===null||typeof v=='undefined'||(v.constructor==Array&&!v.length))
continue;v.constructor==Array?$.merge(val,v):val.push(v);}
return val;};$.fieldValue=function(el,successful){var n=el.name,t=el.type,tag=el.tagName.toLowerCase();if(typeof successful=='undefined')successful=true;if(successful&&(!n||el.disabled||t=='reset'||t=='button'||(t=='checkbox'||t=='radio')&&!el.checked||(t=='submit'||t=='image')&&el.form&&el.form.clk!=el||tag=='select'&&el.selectedIndex==-1))
return null;if(tag=='select'){var index=el.selectedIndex;if(index<0)return null;var a=[],ops=el.options;var one=(t=='select-one');var max=(one?index+1:ops.length);for(var i=(one?index:0);i<max;i++){var op=ops[i];if(op.selected){var v=op.value;if(!v)
v=(op.attributes&&op.attributes['value']&&!(op.attributes['value'].specified))?op.text:op.value;if(one)return v;a.push(v);}}
return a;}
return el.value;};$.fn.clearForm=function(){return this.each(function(){$('input,select,textarea',this).clearFields();});};$.fn.clearFields=$.fn.clearInputs=function(){return this.each(function(){var t=this.type,tag=this.tagName.toLowerCase();if(t=='text'||t=='password'||tag=='textarea')
this.value='';else if(t=='checkbox'||t=='radio')
this.checked=false;else if(tag=='select')
this.selectedIndex=-1;});};$.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=='function'||(typeof this.reset=='object'&&!this.reset.nodeType))
this.reset();});};$.fn.enable=function(b){if(b==undefined)b=true;return this.each(function(){this.disabled=!b;});};$.fn.selected=function(select){if(select==undefined)select=true;return this.each(function(){var t=this.type;if(t=='checkbox'||t=='radio')
this.checked=select;else if(this.tagName.toLowerCase()=='option'){var $sel=$(this).parent('select');if(select&&$sel[0]&&$sel[0].type=='select-one'){$sel.find('option').selected(false);}
this.selected=select;}});};function log(){if($.fn.ajaxSubmit.debug){var msg='[jquery.form] '+Array.prototype.join.call(arguments,'');if(window.console&&window.console.log)
window.console.log(msg);else if(window.opera&&window.opera.postError)
window.opera.postError(msg);}};})(jQuery);var FacebookConnect={status:'unknown',baseUrl:'',loggedIn:false,user:'',genericErrorText:'',permissionErrorText:'',isPayment:false,init:function(url,isLoggedIn,permissionText,genericText){FacebookConnect.baseUrl=url;FacebookConnect.loggedIn=isLoggedIn;FacebookConnect.permissionErrorText=permissionText;FacebookConnect.genericErrorText=genericText;FB.getLoginStatus(function(response){status=response.status;Groupon.log('initial FB status: '+status+' user is logged in?: '+FacebookConnect.loggedIn);if(!FacebookConnect.loggedIn&&status=='connected'){var callback=function(json){Groupon.log('response for auto login: '+json.success);if(json.success){window.location.reload();}}
FacebookConnect.loginHandler(callback);}},true);},connect:function(isPayment,dotdId){FacebookConnect.isPayment=isPayment;if(isPayment)FacebookConnect.dotdId=dotdId;FacebookConnect.toggleFacebookError(false);var newStatus='unknown';Groupon.log('connect callback');FB.getLoginStatus(function(response){newStatus=response.status;Groupon.log('login status: '+newStatus);if(newStatus=='notConnected'){FacebookConnect.toggleFacebookError(true,FacebookConnect.permissionErrorText);}
else if(newStatus=='connected'){var callback=function(json){Groupon.log('login response from app: '+json.success+' url: '+json.url);if(json.success){FacebookConnect.forwardUser(json.url);}
else{FacebookConnect.toggleFacebookError(true,FacebookConnect.genericErrorText)}}
FacebookConnect.loginHandler(callback,response.session.access_token);}
status=newStatus;},true);},loginHandler:function(callback,securityToken){Groupon.log('login handler');FB.api('/me',function(user){Groupon.log('got user: '+user.name);if(user!=null){FacebookConnect.user=user;var dotdId='';var incentive='';var mailIncentive='';if(FacebookConnect.isPayment){if($('select[name="dotdId"]').size()>0){dotdId=$('select[name="dotdId"]').val();}
else{dotdId=$('#fbConnectReloadForm input[name="dotdId"]').val();}}
else{incentive=$('input[name="incentiveRewardToken"]').val();mailIncentive=$('input[name="initialEmailForIncentive"]').val();}
var params={facebookLogin:'','registerView.facebookId':user.id,'registerView.email':user.email,'registerView.firstName':user.first_name,'registerView.lastName':user.last_name,incentiveRewardToken:incentive,initialEmailForIncentive:mailIncentive,dotdId:dotdId,returnJson:true,facebookSecurityToken:securityToken};$.ajax({url:FacebookConnect.baseUrl+'/Registration.action',data:params,dataType:"json",contentType:'application/x-www-form-urlencoded; charset=utf-8',scriptCharset:'utf-8',success:callback,error:function(XMLHttpRequest,textStatus,errorThrown){FacebookConnect.toggleFacebookError(true,FacebookConnect.genericErrorText);}});}});},toggleFacebookError:function(showError,errorText){if(showError){$('#facebookError li').html(errorText);$('#facebookError').show();}
else{$('#facebookError').hide();}},forwardUser:function(url){if(FacebookConnect.isPayment){$('#fbConnectReloadForm input[name="countOfOrderedDeals"]').val($('#countOfDotd').val());if($('select[name="dotdId"]').size()>0){$('#fbConnectReloadForm input[name="dotdId"]').val($('select[name="dotdId"]').val());}
$('#fbConnectReloadForm').get(0).submit();}
else if(url){window.location.href=url;}
else{window.location.href=FacebookConnect.baseUrl;}}}
function setCaptchaField(img){if($(".captchaImage").size()!=0){var field=".captchaImage";if(typeof(img)!='undefined'){field=img;}
$(field).attr("src",$(field).attr("xsrc")+"?"+Math.random());$(".captchaAnswer").val("");}}
function doRefresh(url){if(typeof(url)=='undefined'){url="login";}
window.location.href=url;return false;}
function formatValue(value){return $.formatNumber(parseFloat(value),{format:"00.00",locale:GrouponCountry});}
function formatDateTime(year,month,day,hour,min,pattern){var date=day+'.'+month+'.'+year;var time=hour+':'+min;if(pattern!="null"){var splittedPattern=pattern.split("#/#");if(splittedPattern.length>0){if(splittedPattern[1]!="null"){if(splittedPattern[1].indexOf("#AMPM#")>=0){hour=parseInt(hour);var ampm="AM";if(hour>=12&&hour<=23){if(hour==12){;}else{hour=hour-12;}
ampm="PM";}if(hour==0){hour=12;}
hour=hour+'';time=splittedPattern[1].replace("#HH#",hour);time=time.replace("#MM#",min);time=time.replace("#AMPM#",ampm);}else{time=splittedPattern[1].replace("#HH#",hour);time=time.replace("#MM#",min);}}
if(splittedPattern[0]!="null"){date=splittedPattern[0].replace("#YYYY#",year);date=date.replace("#MM#",month);date=date.replace("#DD#",day);}}}
var dateTime=[date,time];return dateTime;}