
var allCities=new Array();$(document).ready(function(){$('#jAllCities, #jAllCitiesButton').click(function(event){if($('#citySelectBox').is(":visible")){closePanel("citySelectBox");}else{openPanel("citySelectBox");}
event.preventDefault();});function openPanel(panelId){if($.browser.msie&&$.browser.version=='6.0'){var offsetLink=$('#jUserArea').offset();if(offsetLink){var height=$('#jUserArea').outerHeight();var width=$('#jUserArea').outerWidth();var right=$('body').width()-offsetLink.left-width;$('#jUserAreaSubMenuContainer').css('top',(offsetLink.top+height)+'px');$('#jUserAreaSubMenuContainer').css('right',right+'px');}}
$('#'+panelId).slideDown('1000');}
function closePanel(panelId){$('#'+panelId).slideUp('1000');}
$('#jUserArea').click(function(event){if($('#jUserAreaSubMenuContainer').is(":visible")){$('#jUserArea').removeClass("linkActive");closePanel("jUserAreaSubMenuContainer");}else{$('#jUserArea').addClass("linkActive");openPanel("jUserAreaSubMenuContainer");}
event.preventDefault();});$('#headerSubscribeNewsletter #newsletterSubmitBtn span').click(function(){$('#headerSubscribeNewsletter form').submit();event.preventDefault();});$('.statusMessageClose a').click(function(event){closeCitySelectionPanel();event.preventDefault();});$('.jGroupSelector').each(function(){var groupName=$(this).attr('id');var currentElem=$(this);currentElem.click(function(event){$('.jCityGroupContainer, .jTopCitiesSelector').hide();$('#jCityGroupContainer'+groupName+', #jTopCitiesSelector'+groupName).show();$('.jGroupSelector').removeClass('current');currentElem.addClass('current');event.preventDefault();});});$('.jCityLink').each(function(){allCities[allCities.length]={text:$(this).text(),url:$(this).attr('href')};});initCitySelectAutoComplete("jSidebarCitySelectAutoComplete",186,"${searchTitle}");$('.jTopCitiesSelector').click(function(event){$('.jGroupSelector').removeClass('current');$('.jCityGroupContainer, .jTopCitiesSelector').hide();$('.jCityGroupContainerTopCities').show();event.preventDefault();});$('#jSearchSubmitButton').click(function(){loadDealForCity($('#jSidebarCitySelectAutoComplete').val());});$('.popupClose').live('click',function(event){disablePopup();event.preventDefault();});$(document).keydown(function(e){var horizon=$('.horizon:visible');if(e.which==27&&$('#blend').not(':hidden')&&horizon.hasClass('escDisable')){disablePopup(horizon);}});$('#blend').click(function(event){var horizon=$('.horizon:visible');if(horizon&&horizon.hasClass('outerClickDisable')){disablePopup(horizon);}});initRafTracking();initPredefinedInput();setCaptchaField();$('.footerSText .more').click(function(event){$('.footerSText').addClass('footerSTextMore');event.preventDefault();});$('.footerSText .less').click(function(event){$('.footerSText').removeClass('footerSTextMore');event.preventDefault();});$('.jIphoneBanner a.jCloseLink').click(function(){$('.jIphoneBanner .bannerIphoneApp').slideUp();})});function initRafTracking(){$('.jRAF').live('click',function(event){var href=event.href;$.ajax({url:$(this).attr("trackingUrl"),async:false,data:{dotdId:$(this).attr("dotdId"),tracking:true,classes:$(this).attr("class")}});window.open($(this).attr("href"));event.preventDefault();});}
function initPredefinedInput(){$('.predefinedInput').live('focus',function(){if(this.value==this.defaultValue){$(this).removeClass('textDefault');this.value="";}});$('.predefinedInput').live('blur',function(){if(this.value==""){$(this).addClass('textDefault');this.value=this.defaultValue;}});}
function initCitySelectAutoComplete(idSelector,resultWidth,searchTitle){if($('#'+idSelector).length==0){return;}
$('#'+idSelector).autocomplete(allCities,{width:resultWidth,matchContains:true,minChars:1,formatItem:function(item){return item.text;}}).result(function(event,item){location.href=item.url;});$('#'+idSelector).keydown(function(event){if(event.keyCode==13){loadDealForCity($(this).val());}});$('#'+idSelector).dynamicField({text:searchTitle});}
function loadPopup(selector,dontPlaceIt){$("#logo").focus();if($('body > #blend').length==0){$('#blend').appendTo("body");}
if($('#outerWrapper ').length!=0){$('.horizon').parent().appendTo("body");}
if(typeof(selector)!='undefined'){$(selector+", #blend").fadeIn("fast");}else{$("#horizon, #blend").fadeIn("fast");}
if(typeof(dontPlaceIt)!='boolean'||!dontPlaceIt){placePopup(selector);}
$(selector+", #blend").fadeIn("fast");var agent=navigator.userAgent.toLowerCase();if(agent.indexOf('msie')>-1){window.setTimeout('addFilter()',330);}}
function addFilter(){$('#blend').css('filter','alpha(opacity=60)');}
function disablePopup(elem){var horizon=elem;if(typeof(elem)=='undefined'){horizon=$('.horizon:visible');}
if($('#blend').not(':hidden')&&horizon.length==1&&horizon.hasClass('canDisable')){$('#blend').fadeOut('slow');horizon.fadeOut('slow');}}
function showProgressBar(currentSubmit){$('#'+currentSubmit+'Buttons').hide();$('#'+currentSubmit+'ProgressBar').width('0%');$('#'+currentSubmit+'Progress').show();$('#'+currentSubmit+'ProgressBar').animate({width:['100%','swing']},5000);}
function placeMultiPopup(addBuyAsGift,rtl){var offsetBtn;var btn=$('.priceTagMultiDeal');var multiBox=$('.popupMultiDeal');offsetBtn=btn.offset();var staticTop=btn.height()/2;var pfeilspitzelinks=(offsetBtn.top+$('.priceTagMultiDeal .btnBuyMultiDeal').height()/2);var pfeilspitzerechts=(offsetBtn.top+btn.height()/2);var diffrechts=pfeilspitzerechts-offsetBtn.top;var margin=40;staticTop=(pfeilspitzelinks-margin)-diffrechts;multiBox.css('top',(staticTop)+'px');if(rtl!=null){multiBox.css('left',(offsetBtn.left-multiBox.width())+'px');}else{var staticLeft=btn.width();multiBox.css('left',(staticLeft+offsetBtn.left)+'px');}
$('.popupMultiDeal input[name="buyAsGift"]').val(addBuyAsGift);}
var smsSuccessText='';function verifyPhoneNumber(verifyUrl,domainLink,whileRegistration){$(".popupSMS").remove();$('body').append("<div class='popupSMS'></div>");$('.popupSMS').load(verifyUrl,function(){$('.dealsSmsStep02 .captchaDiv').show();$('.dealsSmsStep02').addClass('withCaptcha');$('button[name="checkAuthCode"]').attr('name','checkAuthCodeModified');loadPopup('#popup_dealSms');var successCallback=function(data){Groupon.log(data.isSuccess)};Groupon.log('verify: '+verifyUrl);$('button[name="checkAuthCodeModified"]').bind('click',function(event){var params=$('#jSmsForm_authcode').serialize();var formUrl=$('#jSmsForm_authcode').attr('action');Groupon.log('url: '+formUrl.toString());$.getJSON(formUrl+'?checkAuthCodeModified=',params,function(data){Groupon.log('data: '+data);$('.boxError').hide();$('.boxError ul li').remove();if(typeof(data.isSuccess)!='undefined'){disablePopup();$('#mobileVerificationReminder').hide();$('div.statusMessageSuccess').html('<div class="statusMessageContainer jDynaMessage"><div class="pagewrap"><div class="statusMessageContent">'+smsSuccessText+'</div></div></div>');if(typeof(whileRegistration)!='undefined'){displayRafPopup(domainLink+'/popup_raf?site=${site}&popupType=afterRegister');}}
else{handleSmsError(data);}});event.preventDefault();});});}
function displayRafPopup(url,whileRegistration){if($('#rafPopupDiv form').size()!=0){loadPopup('#rafPopupDiv .horizon');}else{$('body').append('<div id="rafPopupDiv"></div>');$('#rafPopupDiv').load(url,function(){loadPopup('#rafPopupDiv .horizon');});}}
function placePopup(popup){if(navigator.userAgent.toLowerCase().indexOf('msie 6')>-1){var offset=window.pageYOffset?window.pageYOffset:document[(document.compatMode=='CSS1Compat')?'documentElement':'body'].scrollTop;$(popup).css('top',offset+130+'px');}
else{}}
function displaySuccess(success){var selector='.statusMessageSuccess';displayMessage(selector,success);}
function displayError(error){var selector='.statusMessageError';displayMessage(selector,error);}
function displayMessage(containerSelector,message){$(containerSelector).find('.jDynaMessage').remove();var messageElem='<div class="statusMessageContainer jDynaMessage"><div class="pagewrap"><div class="statusMessageContent">';messageElem+=message;messageElem+='</div><div class="statusMessageClose"></div></div></div>';$(containerSelector).append(messageElem);$("#logo").focus();}
function initialiseSendSms(urlPrefix){$(".jDisplaySms").click(function(event){event.preventDefault();var url=urlPrefix+"/popup_sms";url+="?loadPage=03";url+="&mobile="+$(this).nextAll("input[name=mobileNumber]").val();url+="&joinedDealId="+$(this).nextAll("input[name=joinedDealId]").val();url+="&part1ProviderOnly="+$(this).nextAll("input[name=part1ProviderOnly]").val();verifyPhoneNumber(url);});}